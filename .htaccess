# Enable mod_rewrite
<IfModule mod_rewrite.c>
RewriteEngine On

# ----------------------------
# Universal internal rewrite for existing folders
# ----------------------------
# If request is to a directory and has index.php, serve it internally
RewriteCond %{REQUEST_FILENAME} -d
RewriteCond %{REQUEST_FILENAME}/index.php -f
RewriteRule ^(.*)$ $1/index.php [L]

# ----------------------------
# If the request is a file and exists, serve normally
# ----------------------------
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# ----------------------------
# If nothing matches (file or folder does not exist), redirect to 404.php
# ----------------------------
RewriteRule ^.*$ /404.php [L]
</IfModule>

# Disable automatic trailing slash redirect
DirectorySlash Off

# Security: prevent directory listing
Options -Indexes
